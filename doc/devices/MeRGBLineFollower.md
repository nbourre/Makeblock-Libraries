# MeRGBLineFollower Arduino Library Documentation

**Library Author**: MakeBlock  
**Adapted by**: Community contributions  
**Last Updated**: 2025-05-01  

This document describes the public functions available in the `MeRGBLineFollower` Arduino library, designed to interact with the MakeBlock RGB Line Follower module using I2C.

> This documentation has been generated by ChatGPT and is intended for educational purposes. It may not cover all edge cases or specific implementations. Always refer to the code for the most accurate and up-to-date information.

---

## Table of Contents

- [Constructor](#constructor)
- [Initialization](#initialization)
- [Sensor Readings](#sensor-readings)
- [Line Tracking](#line-tracking)
- [Threshold Settings](#threshold-settings)
- [RGB LED Control](#rgb-led-control)
- [Firmware](#firmware)
- [I2C Error Handling](#i2c-error-handling)

---

## Constructor

```cpp
MeRGBLineFollower(uint8_t port = 0);
```

Creates an instance of the RGB Line Follower. The port parameter refers to the RJ25 port on Makeblock boards.

---

## Initialization

### `void begin();`

Initializes I2C communication and prepares the device for operation.

### `void setpin(uint8_t AD0, uint8_t INT);`

Sets the control pins for address selection when not using Makeblock ports.

---

## Sensor Readings

### `void updataAllSensorValue();`

Reads all sensor values and updates internal buffers.

### `uint8_t getADCValueRGB1();`  
### `uint8_t getADCValueRGB2();`  
### `uint8_t getADCValueRGB3();`  
### `uint8_t getADCValueRGB4();`

Returns the raw analog value (0–255) of each of the 4 RGB sensors.

---

## Line Tracking

### `int16_t getPositionOffset();`

Returns the deviation from the center line. Range is -512 (far right) to +512 (far left). Uses PID logic internally.

### `uint8_t getPositionState();`

Returns a 4-bit binary value representing the state of each sensor:
- bit0: RGB1
- bit1: RGB2
- bit2: RGB3
- bit3: RGB4

Each bit is 1 if the corresponding sensor detects the track.

### `void setKp(float value);`

Sets the proportional constant (0.0 to 1.0) used in position offset calculation.

---

## Threshold Settings

### `int8_t setBackgroundThreshold(uint8_t ch, uint8_t threshold);`  
### `int8_t setTrackThreshold(uint8_t ch, uint8_t threshold);`

Sets the background or track detection threshold for sensor index `ch` (0 to 3).

### `uint8_t getBackgroundThreshold(uint8_t ch);`  
### `uint8_t getTrackThreshold(uint8_t ch);`

Returns the current threshold for background or track detection.

---

## RGB LED Control

### `int8_t setRGBColour(uint8_t colour);`

Sets the LED color on the sensor. Accepted values:
- `RGB_COLOUR_RED` (1)
- `RGB_COLOUR_GREEN` (2)
- `RGB_COLOUR_BLUE` (3)

---

## Firmware

### `void getFirmwareVersion(char *buffer);`

Fills the buffer with 8 bytes representing the firmware version string.

---

## I2C Error Handling

### `uint8_t getStudyTypes();`

Returns the study mode state:
- 0 = Idle
- 1 = Learning Background
- 2 = Learning Track

### `int8_t studyBackground();`  
### `int8_t studyTrack();`

Initiates learning mode for background or track.

---

## Summary Table of Public Functions

| Function | Description | Return Type |
|---------|-------------|-------------|
| `begin()` | Initializes the module (I2C setup) | `void` |
| `setpin(AD0, INT)` | Sets address selection pins for manual wiring | `void` |
| `updataAllSensorValue()` | Refreshes internal buffer with current sensor data | `void` |
| `getADCValueRGB1()` – `RGB4()` | Gets raw ADC value of RGB sensor (0–255) | `uint8_t` |
| `getPositionOffset()` | Returns position offset from line (–512 to +512) | `int16_t` |
| `getPositionState()` | Returns bitmask of sensors currently over line (0–15) | `uint8_t` |
| `setKp(value)` | Sets proportional constant for position offset (0.0–1.0) | `void` |
| `setBackgroundThreshold(ch, value)` | Sets background threshold for sensor `ch` | `int8_t` |
| `setTrackThreshold(ch, value)` | Sets track threshold for sensor `ch` | `int8_t` |
| `getBackgroundThreshold(ch)` | Gets background threshold for sensor `ch` | `uint8_t` |
| `getTrackThreshold(ch)` | Gets track threshold for sensor `ch` | `uint8_t` |
| `setRGBColour(colour)` | Sets LED colour on the module (red, green, blue) | `int8_t` |
| `getFirmwareVersion(buffer)` | Fills buffer with firmware version string | `void` |
| `getStudyTypes()` | Returns current learning state (idle/background/track) | `uint8_t` |
| `studyBackground()` | Starts background learning routine | `int8_t` |
| `studyTrack()` | Starts track learning routine | `int8_t` |

### Notes:
- `ch` for thresholds = `0` to `3` for RGB1 to RGB4.
- `colour` is one of: `RGB_COLOUR_RED`, `RGB_COLOUR_GREEN`, `RGB_COLOUR_BLUE`.


---

## Notes

- Always call `updataAllSensorValue()` before reading sensor values.
- Try to avoid I2C saturation by limiting the number of calls to `getPositionOffset()` and `getPositionState()` in a short time frame.

---
